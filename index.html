<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>M·ª•c Ti√™u H·ªçc T·∫≠p</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-image: url('mid.png');
      background-size: cover;
      background-position: center;
      color: #fff;
      text-align: center;
    }
    .container {
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      max-width: 900px;
      margin: 40px auto;
      border-radius: 15px;
    }
    img {
      width: 100%;
      border-radius: 15px;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: #4caf50;
      color: white;
    }
    #progress {
      margin-top: 20px;
      font-size: 18px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #ffffff10;
      overflow-x: auto;
    }
    th, td {
      border: 1px solid #ffffff30;
      padding: 8px;
      color: #fff;
    }
    input[type="time"], textarea {
      padding: 6px;
      border-radius: 6px;
      border: none;
    }
    #dailyQuote {
      font-size: 18px;
      margin-top: 20px;
      padding: 10px;
      background: #ffffff20;
      border-radius: 10px;
    }
    #missedTasksList {
      margin-top: 20px;
      background: #ffffff20;
      padding: 15px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ M·ª•c ti√™u h·ªçc t·∫≠p m·ªói ng√†y</h1>
    <img src="Xiaomi-Mi-11-Ultra.jpg" alt="Ph·∫ßn th∆∞·ªüng">
    <p id="progress">Di·ªÉm hi·ªán t·∫°i: 0 / 3120</p>

    <div id="dailyQuote"></div>

    <div id="daily-buttons">
      <button onclick="diemDanh()">ƒêi·ªÉm danh h√¥m nay (+10)</button><br>
      <button onclick="congDiem('toan', 10)">H·ªçc To√°n (+10)</button>
      <button onclick="congDiem('ly', 10)">H·ªçc L√Ω (+10)</button>
      <button onclick="congDiem('hoa', 10)">H·ªçc H√≥a (+10)</button>
      <button onclick="congDiem('anh', 10)">H·ªçc Ti·∫øng Anh (+10)</button><br>
      <button onclick="congDiem('on', 30)">√în t·∫≠p ki·∫øn th·ª©c (+30)</button>
    </div>

    <div style="margin-top: 20px;">
      <label>‚è∞ ƒê·∫∑t gi·ªù nh·∫Øc h·ªçc: <input type="time" id="reminderTime"> <button onclick="setReminder()">L∆∞u</button></label>
    </div>

    <div style="margin-top: 15px;">
      <button style="background-color:#f44336" onclick="xoaLichHomNay()">üóëÔ∏è X√≥a d·ªØ li·ªáu h√¥m nay</button>
      <button style="background-color:#e91e63" onclick="xoaGhiChuHomNay()">üìú X√≥a ghi ch√∫ h√¥m nay</button>
    </div>

    <div id="missedTasksList"></div>

    <div style="margin-top: 30px;">
      <h2>üóìÔ∏è L·ªãch h·ªçc & Ghi ch√∫</h2>
      <table>
        <thead>
          <tr>
            <th>Ng√†y</th>
            <th>Nhi·ªám v·ª•</th>
            <th>Ghi ch√∫</th>
          </tr>
        </thead>
        <tbody id="calendarBody"></tbody>
      </table>
    </div>
  </div>

<script>
  const TOTAL_DAYS = 312;
  const TOTAL_SCORE = TOTAL_DAYS * 100;
  let diem = parseInt(localStorage.getItem("diem")) || 0;
  let today = new Date().toISOString().split('T')[0];
  let done = JSON.parse(localStorage.getItem("done")) || {};
  let notes = JSON.parse(localStorage.getItem("notes")) || {};
  let reminderTime = localStorage.getItem("reminderTime") || "";
  let lastCheck = localStorage.getItem("lastCheck") || "";

  const tasks = ['on', 'toan', 'ly', 'hoa', 'anh', 'diemdanh'];
  const quotes = [
    "üìö H√¥m nay b·∫°n h·ªçc g√¨ r·ªìi? C·ªë g·∫Øng l√™n nh√©!",
    "üöÄ M·ªói ng√†y m·ªôt b∆∞·ªõc, b·∫°n s·∫Ω ti·∫øn xa!",
    "üí° H·ªçc h√¥m nay - Th√†nh c√¥ng ng√†y mai!",
    "üî• ƒê·ª´ng ƒë·ªÉ ng√†y h√¥m nay tr√¥i qua v√¥ √≠ch!",
    "üå± Tri th·ª©c l√† s·ª©c m·∫°nh, c·ªë l√™n b·∫°n nh√©!"
  ];

  function showDailyQuote() {
    const index = new Date().getDate() % quotes.length;
    document.getElementById("dailyQuote").innerText = quotes[index];
  }

  if (lastCheck && lastCheck !== today) {
    const missed = done[lastCheck] || {}; // ƒë·∫£m b·∫£o d√π kh√¥ng c√≥ v·∫´n tr·ª´
    tasks.forEach(task => {
      if (!missed[task]) diem -= task === 'on' ? 30 : 10;
    });
    diem = Math.max(0, diem);
    localStorage.setItem("diem", diem);
    localStorage.setItem("missedTasks_" + lastCheck, JSON.stringify(tasks.filter(task => !missed[task])));
  }
  localStorage.setItem("lastCheck", today);

  function updateProgress() {
    document.getElementById("progress").innerText = `Di·ªÉm hi·ªán t·∫°i: ${diem} / ${TOTAL_SCORE}`;
    if (diem >= TOTAL_SCORE) alert("üéâ Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh m·ª•c ti√™u v√† gi√†nh ƒë∆∞·ª£c Xiaomi Mi 11 Ultra!");
    renderMissedTasks();
  }

  function congDiem(task, amount) {
    let doneToday = done[today] || {};
    if (doneToday[task]) return alert("B·∫°n ƒë√£ ho√†n th√†nh nhi·ªám v·ª• n√†y h√¥m nay!");
    diem += amount;
    doneToday[task] = true;
    done[today] = doneToday;
    localStorage.setItem("diem", diem);
    localStorage.setItem("done", JSON.stringify(done));
    updateProgress();
    renderCalendar();
  }

  function diemDanh() {
    congDiem("diemdanh", 10);
  }

  function setReminder() {
    const time = document.getElementById("reminderTime").value;
    if (!time) return alert("H√£y ch·ªçn gi·ªù tr∆∞·ªõc!");
    localStorage.setItem("reminderTime", time);
    alert("ƒê√£ l∆∞u gi·ªù nh·∫Øc h·ªçc l√∫c " + time);
  }

  function startReminderCheck() {
    if (!("Notification" in window)) return;
    Notification.requestPermission();
    setInterval(() => {
      const t = localStorage.getItem("reminderTime");
      if (!t) return;
      const now = new Date();
      const nowStr = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
      if (nowStr === t) {
        new Notification("‚è∞ ƒê·∫øn gi·ªù h·ªçc r·ªìi! H√£y ho√†n th√†nh m·ª•c ti√™u h√¥m nay nh√©.");
      }
    }, 60000);
  }

  function renderCalendar() {
    const tbody = document.getElementById("calendarBody");
    tbody.innerHTML = "";
    const days = Object.keys(done).sort().reverse();
    days.forEach(day => {
      const row = document.createElement("tr");
      const noteVal = notes[day] || "";
      row.innerHTML = `
        <td>${day}</td>
        <td>${Object.keys(done[day]).join(", ")}</td>
        <td><textarea onchange="saveNote('${day}', this.value)">${noteVal}</textarea></td>
      `;
      tbody.appendChild(row);
    });
  }

  function renderMissedTasks() {
    const container = document.getElementById("missedTasksList");
    container.innerHTML = "<h3>üîÑ Nhi·ªám v·ª• ch∆∞a l√†m (c√≥ th·ªÉ l√†m b√π)</h3>";
    let html = "";
    for (let i in localStorage) {
      if (i.startsWith("missedTasks_")) {
        const day = i.replace("missedTasks_", "");
        const tasks = JSON.parse(localStorage.getItem(i));
        html += `<div><b>${day}</b>: ${tasks.join(", ")} <button onclick="lamBu('${day}')">L√†m b√π</button></div>`;
      }
    }
    container.innerHTML += html;
  }

  function lamBu(day) {
    const key = "missedTasks_" + day;
    const missedTasks = JSON.parse(localStorage.getItem(key));
    if (!missedTasks) return;
    let added = 0;
    missedTasks.forEach(task => {
      added += task === 'on' ? 30 : 10;
      done[day] = done[day] || {};
      done[day][task] = true;
    });
    diem += added;
    localStorage.removeItem(key);
    localStorage.setItem("diem", diem);
    localStorage.setItem("done", JSON.stringify(done));
    alert(`ƒê√£ l√†m b√π ${missedTasks.length} nhi·ªám v·ª• cho ng√†y ${day} (+${added} ƒëi·ªÉm)`);
    updateProgress();
    renderCalendar();
  }

  function saveNote(day, value) {
    notes[day] = value;
    localStorage.setItem("notes", JSON.stringify(notes));
  }

  function xoaLichHomNay() {
    if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a d·ªØ li·ªáu nhi·ªám v·ª• h√¥m nay kh√¥ng?")) {
      if (done[today]) {
        let lost = 0;
        Object.keys(done[today]).forEach(task => {
          lost += task === 'on' ? 30 : 10;
        });
        diem = Math.max(0, diem - lost);
        delete done[today];
        localStorage.setItem("diem", diem);
        localStorage.setItem("done", JSON.stringify(done));
        alert("ƒê√£ x√≥a nhi·ªám v·ª• h√¥m nay v√† tr·ª´ ƒëi·ªÉm t∆∞∆°ng ·ª©ng.");
        updateProgress();
        renderCalendar();
      }
    }
  }

  function xoaGhiChuHomNay() {
    if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ghi ch√∫ h√¥m nay kh√¥ng?")) {
      if (notes[today]) {
        delete notes[today];
        localStorage.setItem("notes", JSON.stringify(notes));
        alert("ƒê√£ x√≥a ghi ch√∫ h√¥m nay.");
        renderCalendar();
      }
    }
  }

  updateProgress();
  renderCalendar();
  showDailyQuote();
  startReminderCheck();
</script>
</body>
</html>
