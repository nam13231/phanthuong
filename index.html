<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Mục Tiêu Học Tập</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url('mid.png');
      background-size: cover;
      background-position: center;
      color: #fff;
      text-align: center;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 15px;
    }
    .container {
      background: rgba(0, 0, 0, 0.75);
      padding: 30px 30px 40px;
      max-width: 960px;
      width: 100%;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.9);
    }
    h1 {
      font-weight: 700;
      font-size: 2.4rem;
      margin-bottom: 15px;
      text-shadow: 1px 1px 6px #4caf50cc;
    }
    img {
      width: 100%;
      max-width: 400px;
      border-radius: 15px;
      margin: 10px auto 30px;
      display: block;
      box-shadow: 0 0 20px #4caf5077;
    }
    #progress {
      font-size: 1.4rem;
      margin-bottom: 20px;
      font-weight: 600;
      color: #a5d6a7;
      text-shadow: 0 0 5px #388e3c;
    }
    #bonusScoreBox {
      font-size: 1.1rem;
      margin-bottom: 25px;
      font-weight: 500;
      color: #ffd54f;
      text-shadow: 0 0 3px #fbc02d;
    }
    button {
      margin: 5px 7px 10px 7px;
      padding: 10px 22px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #4caf50;
      color: white;
      transition: background-color 0.3s ease;
      box-shadow: 0 4px 8px #388e3caa;
    }
    button:hover:not(:disabled) {
      background-color: #388e3c;
    }
    button:disabled {
      background-color: #666;
      cursor: not-allowed;
      box-shadow: none;
    }
    #countdownTimer {
      margin-top: 10px;
      font-size: 1.3rem;
      color: #ffd54f;
      font-weight: 700;
      text-shadow: 0 0 6px #fbc02d;
      min-height: 30px;
    }
    h3 {
      margin-top: 30px;
      margin-bottom: 12px;
      font-weight: 700;
      color: #81c784;
      text-shadow: 0 0 3px #4caf50cc;
    }
    input[type="number"], input[type="time"], textarea {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      outline: none;
      margin-right: 10px;
      box-shadow: 0 0 5px #4caf5077;
      width: 130px;
      max-width: 90%;
      background: #2e7d32cc;
      color: #e8f5e9;
      transition: background-color 0.3s ease;
    }
    input[type="number"]:focus, input[type="time"]:focus, textarea:focus {
      background: #4caf5088;
      color: #fff;
    }
    #daily-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px 20px;
    }
    #daily-buttons > h3 {
      flex-basis: 100%;
      margin-bottom: 8px;
      margin-top: 24px;
      text-align: left;
    }
    #daily-buttons > button {
      flex: 1 1 140px;
      max-width: 160px;
    }
    #hocThemStats, #missedTasksList {
      background: #ffffff20;
      padding: 15px;
      border-radius: 15px;
      color: #dcedc8;
      font-size: 1.1rem;
      max-width: 900px;
      margin: 25px auto 0;
      text-align: left;
      box-shadow: 0 0 12px #aed581bb;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: #ffffff10;
      border-radius: 10px;
      overflow-x: auto;
      color: #dcedc8;
      box-shadow: 0 0 20px #81c78466;
    }
    th, td {
      border: 1px solid #ffffff30;
      padding: 10px;
      vertical-align: top;
    }
    th {
      background: #4caf5088;
      font-weight: 700;
      font-size: 1rem;
    }
    textarea {
      background: #2e7d32cc;
      color: #e8f5e9;
      border-radius: 8px;
      resize: vertical;
      min-height: 50px;
      width: 100%;
      font-size: 15px;
      padding: 6px 10px;
      border: none;
      outline: none;
      box-shadow: inset 0 0 6px #4caf50aa;
    }
    label {
      font-size: 1.1rem;
      font-weight: 600;
      color: #a5d6a7;
      user-select: none;
    }
    .danger-btn {
      background-color: #f44336;
      box-shadow: 0 4px 8px #d32f2faa;
    }
    .danger-btn:hover {
      background-color: #d32f2f;
    }
    .secondary-btn {
      background-color: #e91e63;
      box-shadow: 0 4px 8px #c2185baa;
    }
    .secondary-btn:hover {
      background-color: #c2185b;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎯 Mục tiêu học tập đến ngày thi 15/06/2026</h1>
    <img src="Xiaomi-Mi-11-Ultra.jpg" alt="Phần thưởng" />

    <p id="progress">Điểm hiện tại: 0 / 1000</p>
    <div id="bonusScoreBox"></div>

    <div id="dailyQuote" style="font-style: italic; font-size:1.3rem; margin-bottom: 15px;"></div>

    <div id="daily-buttons">
      <h3>📅 Điểm danh & Học tập</h3>
      <button onclick="startCheckinTimer()" id="diemDanhBtn">Điểm danh hôm nay (+5)</button>
      <div id="countdownTimer"></div>

      <h3>🧮 Toán</h3>
      <button onclick="congDiem('toan_hoc', 5)">Học Toán (+5)</button>
      <button onclick="congDiem('toan_cauhoi', 5)">Làm 50 câu hỏi Toán (+5)</button>

      <h3>🔭 Lý</h3>
      <button onclick="congDiem('ly_hoc', 5)">Học Lý (+5)</button>
      <button onclick="congDiem('ly_cauhoi', 5)">Làm 50 câu hỏi Lý (+5)</button>

      <h3>⚗️ Hóa</h3>
      <button onclick="congDiem('hoa_hoc', 5)">Học Hóa (+5)</button>
      <button onclick="congDiem('hoa_cauhoi', 5)">Làm 50 câu hỏi Hóa (+5)</button>

      <h3>🇬🇧 Tiếng Anh</h3>
      <button onclick="congDiem('anh_nguPhap', 5)">Học ngữ pháp (+5)</button>
      <button onclick="congDiem('anh_tuVung', 5)">Học 5 từ vựng mới (+5)</button>
 

      <h3>📚 Ôn tập</h3>
      <button onclick="congDiem('on', 20)">Ôn tập kiến thức (+20)</button>

      <h3>🚀 Học thêm</h3>
      <input type="number" id="hocThemPhut" placeholder="Phút học thêm" min="1" />
      <button onclick="hocThem()">Cộng điểm học thêm</button>
    </div>

    <div id="hocThemStats"></div>

    <div style="margin-top:30px;">
      <h3>🏆 Thêm điểm khi đạt điểm tốt</h3>
      <input type="number" id="diemSo" min="7" max="10" placeholder="Nhập điểm 7-10" />
      <button onclick="themDiemSo()">+ Điểm thưởng</button>
    </div>

    <div style="margin-top: 20px;">
      <label>
        ⏰ Nhắc giờ học:
        <input type="time" id="reminderTime" />
        <button onclick="setReminder()">Lưu</button>
      </label>
    </div>

    <div style="margin-top: 15px;">
      <button class="danger-btn" onclick="xoaLichHomNay()">🗑️ Xóa dữ liệu hôm nay</button>
      <button class="secondary-btn" onclick="xoaGhiChuHomNay()">📜 Xóa ghi chú hôm nay</button>
    </div>

    <div id="missedTasksList"></div>

    <div style="margin-top: 40px;">
      <h2>🗓️ Lịch học & Ghi chú</h2>
      <table>
        <thead>
          <tr>
            <th>Ngày</th>
            <th>Nhiệm vụ</th>
            <th>Ghi chú</th>
          </tr>
        </thead>
        <tbody id="calendarBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const TOTAL_SCORE = 18000;
    const milestones = [
      { score: 1000, label: "Mua đồ ăn yêu thích 🍜" },
      { score: 3000, label: "Mua món đồ bạn yêu thích 🧸" },
      { score: 6000, label: "Xiaomi Mi 11 Ultra 📱" },
      { score: 10000, label: "Xiaomi Mi 13 Pro 🚀" },
      { score: 18000, label: "🔥 Xiaomi 16 Pro Max (siêu quà) 🔥" },
    ];

    let diem = parseInt(localStorage.getItem("diem")) || 0;
    let diemThuong = parseInt(localStorage.getItem("diemThuong")) || 0;
    let bonusStats = JSON.parse(localStorage.getItem("bonusStats")) || {};
    let today = new Date().toISOString().split("T")[0];
    let done = JSON.parse(localStorage.getItem("done")) || {};
    let notes = JSON.parse(localStorage.getItem("notes")) || {};
    let lastCheck = localStorage.getItem("lastCheck") || "";
    const tasks = [
      "on",
      "toan_hoc",
      "toan_cauhoi",
      "ly_hoc",
      "ly_cauhoi",
      "hoa_hoc",
      "hoa_cauhoi",
      "anh_nguPhap",
      "anh_tuVung",
      "anh_nghe",
      "diemdanh",
    ];
    const quotes = [
      "📚 Hôm nay bạn học gì rồi? Cố gắng lên nhé!",
      "🚀 Mỗi ngày một bước, bạn sẽ tiến xa!",
      "💡 Học hôm nay - Thành công ngày mai!",
      "🔥 Đừng để ngày hôm nay trôi qua vô ích!",
      "🌱 Tri thức là sức mạnh, cố lên bạn nhé!",
    ];

    // Kiểm tra điểm danh ngày trước, trừ điểm nếu nhiệm vụ chưa làm
    if (lastCheck && lastCheck !== today) {
      const missed = done[lastCheck] || {};
      tasks.forEach((task) => {
        if (!missed[task]) diem -= task === "on" ? 20 : 5;
      });
      diem = Math.max(0, diem);
      localStorage.setItem("diem", diem);
      localStorage.setItem(
        "missedTasks_" + lastCheck,
        JSON.stringify(tasks.filter((task) => !missed[task]))
      );
    }
    localStorage.setItem("lastCheck", today);

    // 15 phút đếm ngược điểm danh
    const CHECKIN_TIME = 15 * 60; // 15 phút (giây)
    let checkinStart = parseInt(localStorage.getItem("checkinStart")) || 0;
    let checkinTimerId = null;

    function updateProgress() {
      const milestone = getCurrentMilestone();
      const nextMilestone = getNextMilestone();

      if (!nextMilestone) {
        // Đã vượt mốc cao nhất
        document.getElementById(
          "progress"
        ).innerText = `Điểm hiện tại: ${diem} / ${TOTAL_SCORE} (Đạt mốc cao nhất!) 🎉`;
      } else {
        const currentBase = milestone ? milestone.score : 0;
        const currentProgress = diem - currentBase;
        const needed = nextMilestone.score - currentBase;
        document.getElementById(
          "progress"
        ).innerText = `Điểm hiện tại: ${currentProgress} / ${needed} (Tiến đến: ${nextMilestone.label})`;
      }

      document.getElementById(
        "bonusScoreBox"
      ).innerText = `Tổng điểm từ điểm tốt: ${diemThuong}`;

      // Hiện phần thưởng đạt được
      let rewardsText = "🎁 Phần thưởng đã nhận:\n";
      milestones.forEach(({ score, label }) => {
        if (diem >= score) {
          rewardsText += `✔️ ${label}\n`;
        }
      });

      // Có thể thêm phần thưởng lên UI nếu muốn
      // alert nếu đạt mốc mới? (Có thể thêm tính năng này)

      updateBonusStats();
      renderMissedTasks();

      if (diem >= TOTAL_SCORE) {
        alert("🎉 Chúc mừng bạn đã đạt được phần thưởng cao nhất: Xiaomi 16 Pro Max!");
      }
    }

    // Tìm mốc phần thưởng hiện tại dựa trên điểm
    function getCurrentMilestone() {
      let current = null;
      for (let i = milestones.length - 1; i >= 0; i--) {
        if (diem >= milestones[i].score) {
          current = milestones[i];
          break;
        }
      }
      return current;
    }

    // Tìm mốc tiếp theo
    function getNextMilestone() {
      for (let i = 0; i < milestones.length; i++) {
        if (diem < milestones[i].score) return milestones[i];
      }
      return null;
    }

    function congDiem(task, amount) {
      let doneToday = done[today] || {};
      if (doneToday[task]) return alert("Bạn đã làm nhiệm vụ này hôm nay rồi!");
      diem += amount;
      doneToday[task] = true;
      done[today] = doneToday;
      localStorage.setItem("diem", diem);
      localStorage.setItem("done", JSON.stringify(done));
      updateProgress();
      renderCalendar();
    }

    // Hàm điểm danh có 15 phút đếm ngược
    function startCheckinTimer() {
      if (done[today] && done[today]["diemdanh"]) {
        alert("Bạn đã điểm danh hôm nay rồi!");
        return;
      }
      if (checkinStart === 0) {
        checkinStart = Date.now();
        localStorage.setItem("checkinStart", checkinStart);
        startCountdown();
      } else {
        alert("Bạn đang trong thời gian học 15 phút, vui lòng hoàn thành để được điểm danh.");
      }
    }

    function startCountdown() {
      const countdownElem = document.getElementById("countdownTimer");
      if (checkinTimerId) clearInterval(checkinTimerId);

      function update() {
        let now = Date.now();
        let elapsed = Math.floor((now - checkinStart) / 1000);
        let remain = CHECKIN_TIME - elapsed;

        if (remain <= 0) {
          congDiem("diemdanh", 5);
          countdownElem.innerText = "🎉 Đã hoàn thành 15 phút học, điểm danh +5 điểm!";
          localStorage.removeItem("checkinStart");
          checkinStart = 0;
          clearInterval(checkinTimerId);
          document.getElementById("diemDanhBtn").disabled = false;
        } else {
          let min = Math.floor(remain / 60)
            .toString()
            .padStart(2, "0");
          let sec = (remain % 60).toString().padStart(2, "0");
          countdownElem.innerText = `⏳ Thời gian học: ${min}:${sec}`;
          document.getElementById("diemDanhBtn").disabled = true;
        }
      }
      update();
      checkinTimerId = setInterval(update, 1000);
    }

    function hocThem() {
      let minutes = parseInt(document.getElementById("hocThemPhut").value);
      if (isNaN(minutes) || minutes <= 0)
        return alert("Nhập số phút hợp lệ!");
      let diemCong = Math.min(30, Math.floor(minutes / 2));
      diem += diemCong;
      let date = new Date();
      let keyWeek = getWeekNumber(date);
      let keyMonth = date.getMonth();
      bonusStats[keyWeek] = (bonusStats[keyWeek] || 0) + diemCong;
      bonusStats["m" + keyMonth] = (bonusStats["m" + keyMonth] || 0) + diemCong;
      localStorage.setItem("bonusStats", JSON.stringify(bonusStats));
      localStorage.setItem("diem", diem);
      alert(`+${diemCong} điểm từ học thêm!`);
      updateProgress();
      document.getElementById("hocThemPhut").value = "";
    }

    function themDiemSo() {
      let val = parseInt(document.getElementById("diemSo").value);
      let cong = 0;
      if (val === 7) cong = 5;
      else if (val === 8) cong = 10;
      else if (val === 9) cong = 15;
      else if (val === 10) cong = 20;
      else return alert("Chỉ nhận điểm từ 7 đến 10");
      diem += cong;
      diemThuong += cong;
      localStorage.setItem("diem", diem);
      localStorage.setItem("diemThuong", diemThuong);
      updateProgress();
      alert(`+${cong} điểm thưởng từ điểm ${val}`);
      document.getElementById("diemSo").value = "";
    }

    function updateBonusStats() {
      let now = new Date();
      let w = getWeekNumber(now);
      let m = "m" + now.getMonth();
      let week = bonusStats[w] || 0;
      let month = bonusStats[m] || 0;
      document.getElementById(
        "hocThemStats"
      ).innerHTML = `📊 Điểm học thêm tuần này: ${week} | tháng này: ${month}`;
    }

    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      let yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil((((d - yearStart) / 86400000 + 1) / 7));
    }

    function renderCalendar() {
      const tbody = document.getElementById("calendarBody");
      tbody.innerHTML = "";
      const days = Object.keys(done).sort().reverse();
      days.forEach((day) => {
        const row = document.createElement("tr");
        const noteVal = notes[day] || "";
        row.innerHTML = `<td>${day}</td><td>${Object.keys(
          done[day]
        ).join(", ")}</td><td><textarea onchange="saveNote('${day}', this.value)">${noteVal}</textarea></td>`;
        tbody.appendChild(row);
      });
    }

    function renderMissedTasks() {
      const container = document.getElementById("missedTasksList");
      container.innerHTML = "<h3>🔄 Nhiệm vụ chưa làm (có thể làm bù)</h3>";
      let html = "";
      for (let i in localStorage) {
        if (i.startsWith("missedTasks_")) {
          const day = i.replace("missedTasks_", "");
          const tasks = JSON.parse(localStorage.getItem(i));
          html += `<div><b>${day}</b>: ${tasks.join(
            ", "
          )} <button onclick="lamBu('${day}')">Làm bù</button></div>`;
        }
      }
      container.innerHTML += html;
    }

    function lamBu(day) {
      const key = "missedTasks_" + day;
      const missedTasks = JSON.parse(localStorage.getItem(key));
      if (!missedTasks) return;
      let added = 0;
      missedTasks.forEach((task) => {
        added += task === "on" ? 20 : 5;
        done[day] = done[day] || {};
        done[day][task] = true;
      });
      diem += added;
      localStorage.removeItem(key);
      localStorage.setItem("diem", diem);
      localStorage.setItem("done", JSON.stringify(done));
      alert(`Đã làm bù ${missedTasks.length} nhiệm vụ ngày ${day} (+${added} điểm)`);
      updateProgress();
      renderCalendar();
    }

    function saveNote(day, value) {
      notes[day] = value;
      localStorage.setItem("notes", JSON.stringify(notes));
    }

    function xoaLichHomNay() {
      if (confirm("Xóa tất cả nhiệm vụ hôm nay?")) {
        if (done[today]) {
          let lost = 0;
          Object.keys(done[today]).forEach((task) => {
            lost += task === "on" ? 20 : 5;
          });
          diem = Math.max(0, diem - lost);
          delete done[today];
          localStorage.setItem("diem", diem);
          localStorage.setItem("done", JSON.stringify(done));
          alert("Đã xóa nhiệm vụ hôm nay và trừ điểm tương ứng.");
          updateProgress();
          renderCalendar();
        }
      }
    }

    function xoaGhiChuHomNay() {
      if (confirm("Xóa ghi chú hôm nay?")) {
        if (notes[today]) {
          delete notes[today];
          localStorage.setItem("notes", JSON.stringify(notes));
          alert("Đã xóa ghi chú hôm nay.");
          renderCalendar();
        }
      }
    }

    function setReminder() {
      const time = document.getElementById("reminderTime").value;
      if (!time) return alert("Hãy chọn giờ!");
      localStorage.setItem("reminderTime", time);
      alert("Đã lưu giờ nhắc học: " + time);
    }

    function startReminderCheck() {
      if (!("Notification" in window)) return;
      Notification.requestPermission();
      setInterval(() => {
        const t = localStorage.getItem("reminderTime");
        if (!t) return;
        const now = new Date();
        const nowStr =
          now.getHours().toString().padStart(2, "0") +
          ":" +
          now.getMinutes().toString().padStart(2, "0");
        if (nowStr === t) {
          new Notification("⏰ Đến giờ học rồi! Hãy hoàn thành mục tiêu hôm nay nhé.");
        }
      }, 60000);
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateProgress();
      renderCalendar();
      startReminderCheck();
      document.getElementById("dailyQuote").innerText = quotes[new Date().getDate() % quotes.length];

      if (checkinStart !== 0) {
        startCountdown();
      }
    });
  </script>
</body>
</html>



